var Je=Object.create;var V=Object.defineProperty;var Qe=Object.getOwnPropertyDescriptor;var Xe=Object.getOwnPropertyNames;var er=Object.getPrototypeOf,rr=Object.prototype.hasOwnProperty;var tr=(e,r)=>{for(var n in r)V(e,n,{get:r[n],enumerable:!0})},Fe=(e,r,n,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of Xe(r))!rr.call(e,o)&&o!==n&&V(e,o,{get:()=>r[o],enumerable:!(t=Qe(r,o))||t.enumerable});return e};var h=(e,r,n)=>(n=e!=null?Je(er(e)):{},Fe(r||!e||!e.__esModule?V(n,"default",{value:e,enumerable:!0}):n,e)),nr=e=>Fe(V({},"__esModule",{value:!0}),e);var br={};tr(br,{accessor:()=>ne,componentName:()=>_,createInferencer:()=>Ye,dataProviderFromResource:()=>L,dotAccessor:()=>B,getAccessorKey:()=>oe,getFieldableKeys:()=>E,getOptionLabel:()=>pe,getVariableName:()=>fe,isIDKey:()=>ce,jsx:()=>X,noOp:()=>le,prettyString:()=>S,printImports:()=>se,removeRelationSuffix:()=>x,shouldDotAccess:()=>z,toPlural:()=>T,toSingular:()=>v});module.exports=nr(br);var C=h(require("react")),ye=require("@pankod/refine-core");var or=/(image|photo|avatar|url|logo|cover|thumbnail|icon)/i,E=(e,r)=>{let n=["name","label","title","count","content","username","nickname","login","firstName","lastName","url"];or.test(e)&&n.unshift("url");let t=n.find(o=>o in r&&!!r[o]);if(t)return t==="firstName"&&"lastName"in r?["firstName","lastName"]:t};function Z(e,r,n){var o;if(r)return r;let t=n==null?void 0:n.find(s=>s.name===e);return(o=t==null?void 0:t.options)!=null&&o.dataProviderName?t.options.dataProviderName:"default"}var L=e=>{var r;return(r=e==null?void 0:e.options)==null?void 0:r.dataProviderName};var M=e=>{let r=[...e].filter(Boolean).sort((n,t)=>(t.priority||0)-(n.priority||0))[0];return r||null};var sr=h(require("prettier/standalone")),ir=h(require("prettier/parser-typescript"));var q=e=>e.replace(/ {2,}/g," ").replace(/\n{2,}/g,`
`);var Y=/(-id|-ids|_id|_ids|Id|Ids|ID|IDs)(\[\])?$/,be=(e,r)=>{let n=Y.test(e),t=typeof r=="string"||typeof r=="number",o=Array.isArray(r)&&r.every(s=>typeof s=="string"||typeof s=="number");return n&&t||n&&o?{key:e,relation:!0,multiple:!!o,type:"relation",priority:1}:!1};var x=e=>e.replace(Y,"");var S=e=>x(e).replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").replace(/-/g," ").split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ");var G=e=>e.replace(/export\s+(const|let|var|type|interface|function|class)\s+(\w+)\s*(=|:)\s*/g,"$1 $2 = ").split(`
`).filter(o=>!o.trim().startsWith("export default")).join(`
`);var Ae=/import(?:(?:(?:[ \n\t]+([^ *\n\t\{\},]+)[ \n\t]*(?:,|[ \n\t]+))?([ \n\t]*\{(?:[ \n\t]*[^ \n\t"'\{\}]+[ \n\t]*,?)+\})?[ \n\t]*)|[ \n\t]*\*[ \n\t]*as[ \n\t]+([^ \n\t\{\}]+)[ \n\t]+)from[ \n\t]*(?:['"])([^'"\n]+)(?:['"])(?:;?)/g,ar=/import[ \n\t](?:['"])([^'"\n]+)(?:['"])(?:;?)/g,cr=/((?:\w|\s|_)*)( as )((?:\w|\s|_)*)( |,)?/g,J=(e,r={})=>{let n=e.matchAll(Ae),t=new Set;for(let o of n){let[,s,a,l,p]=o;if(p in r){let m=r[p];if(p==="react")continue;s&&t.add(`const { default: ${s} } = ${m};`),a&&t.add(`const${a.replace(cr,"$1: $3$4")} = ${m};`),l&&t.add(`const ${l} = ${m};`)}}return q(`
    ${Array.from(t).join(`
`)}
    ${e.replace(Ae,"").replace(ar,"")}
    `)};var D=h(require("pluralize"));var Q=(e,r)=>e?r.find(t=>{let o=x(e.key);return t.name===o||t.name===(D.default.isPlural(o)?o:D.default.plural(o))||t.name===(D.default.isSingular(o)?o:D.default.singular(o))}):void 0;var ke=h(require("pluralize"));var _=(e,r,n="Inferred")=>{let t=e.replace(/[^a-zA-Z0-9]/g," "),o=ke.default.singular(t),a=S(o).replace(/ /g,"")||n,l=r.charAt(0).toUpperCase()+r.slice(1);return/^[a-zA-Z]/.test(a)?`${a}${l}`:`${l}${a}`};var pr=e=>e?Array.isArray(e)?e.join(""):typeof e=="string"?e:typeof e=="object"||typeof e=="function"?e.toString():typeof e=="number"?String(e):typeof e=="boolean"&&e?"true":e:"",X=(e,...r)=>e.reduce((t,o,s)=>`${t}${o}${pr(r[s])}`,"").trim();var ee=(e,r)=>`
    ${e!=null?e:""}
    
    render(typeof ${r} !== "undefined" ? <${r} /> : <></>);
    `;var re=e=>e==null?void 0:e.replace(/(\/\* hidden-start \*\/)(.|\n)*?(\/\* hidden-end \*\/)/g,"");var lr=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/,z=e=>lr.test(e);function te(e,r,n){let t=`${e}`;return r&&(t+="?.",z(r)?t+=r:t+=`['${r}']`),n&&(t+="?.",z(n)?t+=n:t+=`['${n}']`),t}function fr(e,r,n){return(n!=null?n:[]).map(o=>te(e,r,o))}var ne=(e,r,n,t=' + " " + ')=>Array.isArray(n)?t?fr(e,r,n).join(t):te(e,r,n[0]):te(e,r,n),B=(e,r,n)=>{let t=e;return r&&(t+=`.${r}`),n&&(Array.isArray(n)?t+=`.${n[0]}`:t+=`.${n}`),t},oe=e=>Array.isArray(e.accessor)||e.multiple?`accessorKey: "${e.key}"`:e.accessor?`accessorKey: "${B(e.key,void 0,e.accessor)}"`:`accessorKey: "${e.key}"`;var se=e=>{let r=e.reduce((t,[o,s,a])=>(t[s]||(t[s]=[]),t[s].includes(o)||(a?t[s].push([o,!0]):t[s].push(o)),t),{});return Object.entries(r).map(([t,o])=>{let s=o.find(m=>Array.isArray(m)&&m[1]),a=o.filter(m=>typeof m=="string"),l=s?`${s[0]}`:"",p=a.length?`{ ${a.join(", ")} }`:"";return`import ${l}${l&&p?", ":""}${p} from "${t}";`})};var ie=h(require("pluralize")),v=(e="")=>ie.default.isSingular(e)?e:ie.default.singular(e);var ae=h(require("pluralize")),T=(e="")=>ae.default.isPlural(e)?e:ae.default.plural(e);var mr=/^id$/i,ce=e=>mr.test(e);var pe=e=>e.relationInfer&&e.relationInfer.accessor?Array.isArray(e.relationInfer.accessor)?`optionLabel: "${e.relationInfer.accessor[0]}",`:e.relationInfer.accessor!=="title"?`optionLabel: "${e.relationInfer.accessor}",`:"":"";var le=e=>{};var fe=(e,r="")=>{if(Number.isInteger(Number(e)))return r.charAt(0).toLowerCase()+r.slice(1)+e;let t=e.replace(/^\d+/,"").replace(/[^a-zA-Z0-9]/g,"-"),o=S(t).replace(/ /g,"");return`${o.charAt(0).toLowerCase()+o.slice(1)}${r.charAt(0).toUpperCase()+r.slice(1)}`};var Ce=e=>{let r=(n,t,o,s=r)=>{let a=e.map(p=>p(n,t,o,s));return M(a)};return r};var Re=e=>(n,t,o,s,a)=>e.reduce((l,p)=>p(l,t,o,s,a),n);var $e=(e,r,n,t)=>{let o=Array.isArray(r),s=Array.isArray(r)&&r.every(a=>typeof a=="string"||typeof a=="number");if(o){if(!s){let l=t(e,r[0],n,t);return l?{...l,key:e,multiple:!0,priority:1}:!1}let a=t(e,r[0],n,t)||{type:"string"};return{key:e,multiple:!0,priority:1,type:a==null?void 0:a.type}}return!1};var we=(e,r)=>typeof r=="boolean"?{key:e,type:"boolean"}:!1;var me=h(require("dayjs")),ur=/(_at|_on|At|On|AT|ON)(\[\])?$/,ve=(e,r)=>{let n=ur.test(e)&&(0,me.default)(r).isValid(),t=typeof r=="string"&&(0,me.default)(r).isValid(),o=typeof r=="string"&&r.length>4;return n||t&&o?{key:e,type:"date",priority:1}:!1};var dr=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,Te=(e,r)=>typeof r=="string"&&dr.test(r)?{key:e,type:"email",priority:1}:!1;var gr=/\.(gif|jpe?g|tiff?|png|webp|bmp|svg)$/i,Ne=(e,r)=>typeof r=="string"&&gr.test(r)?{key:e,type:"image",priority:2}:!1;var Pe=(e,r)=>typeof r>"u"||r===null?null:!1;var Le=(e,r)=>typeof r=="number"?{key:e,type:"number"}:!1;var yr=/id$/i,Se=(e,r,n,t)=>{let o=r!==null,s=!Array.isArray(r);if(o&&s&&typeof r=="object"){if(Object.keys(r).length===1&&yr.test(Object.keys(r)[0]))return{key:e,type:"relation",relation:!0,accessor:"id",priority:1};let p=E(e,r);if((p?p.length>0:!1)&&p){let y=p&&Array.isArray(p)?p[0]:p,u=t(y,r[y],r,t);if(u){let f=Array.isArray(p)?p.map(d=>u.accessor?`${d}.${Array.isArray(u.accessor)?u.accessor[0]:u.accessor}`:d):u.accessor?Array.isArray(u.accessor)?`${p}.${u.accessor[0]}`:`${p}.${u.accessor}`:p;return{...u,fieldable:!0,key:e,accessor:f,priority:1}}}return{key:e,fieldable:!1,type:"object",priority:1}}return!1};var Ke=(e,r)=>typeof r=="string"&&r.length>100?{key:e,type:"richtext",priority:1}:!1;var je=(e,r)=>typeof r=="string"?{key:e,type:"text"}:!1;var Ir=/^(https?|ftp):\/\/(-\.)?([^\s/?\.#-]+\.?)+(\/[^\s]*)?$/i,Ee=(e,r)=>typeof r=="string"&&Ir.test(r)?{key:e,type:"url",priority:1}:!1;var De=[$e,we,ve,Te,Ne,Pe,Le,Se,be,Ke,je,Ee];var _e=(e,r,n,t)=>e.map(s=>{if(!s.relation&&(s.type==="text"||s.type==="richtext"||s.type==="number")&&!s.canRelation){let a=/^[a-z0-9-]+$/,l=f=>a.test(`${f}`),p=s.key.toLowerCase()!=="id";return!(!s.accessor||typeof s.accessor=="string")||!p?s:(s.multiple?t[s.key]:[t[s.key]]).every(f=>l(s.accessor?f[s.accessor]:f))?{...s,canRelation:!0}:s}return s});var hr=/(image|photo|avatar|cover|thumbnail|icon)/i,ze=e=>e.map(n=>n.type==="url"&&hr.test(n.key)?{...n,type:"image"}:n);var Oe=(e,r)=>e.map(t=>{let o=Q(t,r);return o?{...t,relation:!0,type:"relation",resource:o}:t});var Ue=(e,r,n,t,o)=>e.map(a=>{if(a.relation&&a.type==="relation"&&!a.resource){let l=a.accessor?t[a.key][a.accessor]:t[a.key],p=o(a.key,l,t,o);if(p&&p.type!=="relation")return{...a,fieldable:!0,relation:!1,type:p.type,canRelation:!0}}return a});var Ve=[ze,Oe,Ue,_e];var Be=h(require("react")),He=h(require("prism-react-renderer")),xr=h(require("prism-react-renderer/themes/vsDark"));var b=h(require("react")),Fr=h(require("@pankod/refine-core")),H=require("@aliemir/react-live");var We=[["react","React",b.default],["@pankod/refine-core","RefineCore",Fr]],ue=b.default.createContext({}),de=({fetchError:e,code:r,additionalScope:n,errorComponent:t})=>{var l;let o=(l=r&&G(J(r,[...We,...n!=null?n:[]].reduce((p,[m,y,u,f])=>f?p:{...p,[m]:y},{}))))!=null?l:"",s=b.default.useMemo(()=>({React:b.default,...b.default,...[...We,...n!=null?n:[]].reduce((p,[m,y,u])=>({...p,[y]:u}),{})}),[n]),a=b.default.useMemo(()=>()=>{let{error:m}=b.default.useContext(ue);return t?b.default.createElement(t,{error:m?`<p>An error occured while rendering the generated component.You can check the generated code from the below "Show Code" button and fix the error manually.</p>
                                    <p>If you think this is a bug, please report the issue at <a target="_blank" rel="noopener noreferrer" href="https://github.com/refinedev/refine/issues">https://github.com/refinedev/refine/issues</a></p>
                                    <p>Exception:</p>
                                    <code>${m}</code>`:typeof e=="string"?e:e?`<p>Something went wrong while fetching the resource data.</p>
                                    <p>To learn more about the Inferencer, please check the <a href="https://refine.dev/docs/packages/documentation/inferencer/" target="_blank">documentation</a>.</p>`:void 0}):null},[t,e]);return b.default.createElement(H.LiveProvider,{Context:ue,code:o,scope:s,noInline:!0},!e&&b.default.createElement(H.LivePreview,{Context:ue}),b.default.createElement(a,null))};var K=h(require("react")),W=require("@pankod/refine-core");var Ze=(e,r,n)=>{let{resource:t,resourceName:o,id:s,resources:a}=(0,W.useResource)({resourceNameOrRouteName:r}),l=n!=null?n:s,p=(0,W.useDataProvider)(),[m,y]=K.default.useState(void 0),[u,f]=K.default.useState(void 0),[d,$]=K.default.useState(!0),[i,A]=K.default.useState(!1),w=K.default.useCallback(async I=>{var N,P;let g=(N=L(t))!=null?N:Z(o,void 0,a),k=p(g);A(!0),y(void 0);try{if(e==="list"||e==="create"){let F=(P=(await k.getList({resource:o})).data)==null?void 0:P[0];F||y(`<p>No records/data found for resource "${o}".</p>
                            <p>Please check your data provider and resource.</p>
                            <p>For more info, please check the <a href="https://refine.dev/docs/packages/documentation/inferencer/" target="_blank">documentation</a>.</p>`),f(F),setTimeout(()=>{A(!1)},500)}if((e==="edit"||e==="show")&&I){let F=(await k.getOne({resource:o,id:I})).data;F||y(`<p>No records/data found for resource "${o}".</p>
                            <p>Please check your data provider and resource.</p>
                            <p>For more info, please check the <a href="https://refine.dev/docs/packages/documentation/inferencer/" target="_blank">documentation</a>.</p>`),f(F),setTimeout(()=>{A(!1)},500)}}catch(R){console.warn("An error occured while fetching the resource data. Please check the error message below:",R),y(`<p>Something went wrong while fetching the resource data.</p>
                    <p>Please check your data provider and API for resource "${o}".</p>
                    <p>For more info, please check the <a href="https://refine.dev/docs/packages/documentation/inferencer/" target="_blank">documentation</a>.</p>`),setTimeout(()=>{A(!1)},500)}},[e,p,t,o,a]);return K.default.useEffect(()=>{$(!1),!i&&!u&&w(l)},[w,l]),{data:u,loading:i,initial:d,error:m}};var j=h(require("react")),Me=require("@pankod/refine-core");var ge=require("lodash"),qe=({record:e,fields:r,infer:n})=>{let t=(0,Me.useDataProvider)(),[o,s]=j.default.useState([]),[a,l]=j.default.useState(!0),[p,m]=j.default.useState(!1),y=j.default.useCallback(async u=>{console.groupCollapsed("@pankod/refine-inferencer is trying to detect relations");let f=[];m(!0);try{let d=u.map(async i=>{if(i&&(i.relation||i.canRelation)&&e){let A=L(i.resource),w=t(A),I=Array.isArray(i.accessor)?void 0:i.multiple?e[i.key].map(g=>i.accessor?(0,ge.get)(g,i.accessor):g)[0]:i.accessor?(0,ge.get)(e[i.key],i.accessor):e[i.key];if(I&&i.resource)try{let{data:g}=await w.getOne({resource:i.resource.name,id:I});f.push({status:"success",resource:i.resource.name,field:i.key});let k=n("__",g,{},n);return{...i,relationInfer:k}}catch{return f.push({status:"error",resource:i.resource.name,field:i.key}),{...i,relationInfer:null}}if(I){let g,k;try{let{data:R}=await w.getOne({resource:T(x(i.key)),id:I});f.push({status:"success",resource:T(x(i.key)),field:i.key}),g=R,k=!0}catch{f.push({status:"error",resource:T(x(i.key)),field:i.key});try{let{data:F}=await w.getOne({resource:v(x(i.key)),id:I});f.push({status:"success",resource:v(x(i.key)),field:i.key}),g=F,k=!1}catch{return f.push({status:"error",resource:v(x(i.key)),field:i.key}),{...i,relationInfer:null}}}let N=n("__",g,{},n),P=x(i.key);return{...i,relation:!0,type:"relation",resource:{name:k?T(P):v(P)},fieldable:!1,canRelation:void 0,relationInfer:N}}return{...i,relationInfer:null}}return i}),$=await Promise.all(d);s($.filter(i=>i)),setTimeout(()=>{m(!1)},500)}catch{setTimeout(()=>{m(!1)},500)}setTimeout(()=>{console.log(`Tried to detect relations with ${f.length} attempts and succeeded with ${f.filter(d=>d.status==="success").length} attempts.`),console.groupEnd()},500)},[t,e]);return j.default.useEffect(()=>{l(!1),!p&&r&&r.length>0&&o.length===0&&y(r)},[y,p,r,y]),{fields:o,loading:p,initial:a}};var Ye=({type:e,additionalScope:r=[],customElements:n=[],fieldTransformers:t=[],renderer:o,loadingComponent:s,errorComponent:a,codeViewerComponent:l})=>{let p=Ce([...De,...n]),m=Re([...Ve,...t]),y=({resourceName:f,fieldTransformer:d,id:$})=>{var he;let{resource:i,resources:A}=(0,ye.useResource)({resourceNameOrRouteName:f}),{resource:w}=(0,ye.useResource)(),{data:I,loading:g,initial:k,error:N}=Ze(e,f!=null?f:i==null?void 0:i.name,$),P=C.default.useMemo(()=>{if(I){let Ge=Object.keys(I).map(O=>{let U=I[O];return p(O,U,I,p)}).filter(Boolean),xe=m(Ge,A,i,I,p);return d?xe.flatMap(O=>{let U=d(O);return U?[U]:[]}):xe}return[]},[I,A,i,d]),{fields:R,loading:F}=qe({record:I,fields:P,infer:p}),Ie=C.default.useMemo(()=>!g&&!F&&!k?o({resource:i,resources:A,fields:R,infer:p,isCustomPage:i.name!==w.name,id:$}):"",[i,A,R,g,F]);return C.default.createElement(C.default.Fragment,null,s&&(g||F)&&C.default.createElement(s,null),!g&&!F&&C.default.createElement(C.default.Fragment,null,C.default.createElement(de,{fetchError:!g&&N?N:!g&&!k&&!I,code:ee(Ie,_((he=i.label)!=null?he:i.name,e)),errorComponent:a,additionalScope:r}),l&&C.default.createElement(l,{code:re(Ie),loading:g||F})))};return({name:f,resource:d,fieldTransformer:$,id:i})=>C.default.createElement(y,{fieldTransformer:$,resourceName:d!=null?d:f,key:d!=null?d:f,id:i})};
//# sourceMappingURL=index.js.map