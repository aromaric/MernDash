import A from"react";import{useResource as _e}from"@pankod/refine-core";var Oe=/(image|photo|avatar|url|logo|cover|thumbnail|icon)/i,E=(e,r)=>{let n=["name","label","title","count","content","username","nickname","login","firstName","lastName","url"];Oe.test(e)&&n.unshift("url");let t=n.find(o=>o in r&&!!r[o]);if(t)return t==="firstName"&&"lastName"in r?["firstName","lastName"]:t};function O(e,r,n){var o;if(r)return r;let t=n==null?void 0:n.find(s=>s.name===e);return(o=t==null?void 0:t.options)!=null&&o.dataProviderName?t.options.dataProviderName:"default"}var N=e=>{var r;return(r=e==null?void 0:e.options)==null?void 0:r.dataProviderName};var U=e=>{let r=[...e].filter(Boolean).sort((n,t)=>(t.priority||0)-(n.priority||0))[0];return r||null};import ur from"prettier/standalone";import gr from"prettier/parser-typescript";var V=e=>e.replace(/ {2,}/g," ").replace(/\n{2,}/g,`
`);var B=/(-id|-ids|_id|_ids|Id|Ids|ID|IDs)(\[\])?$/,te=(e,r)=>{let n=B.test(e),t=typeof r=="string"||typeof r=="number",o=Array.isArray(r)&&r.every(s=>typeof s=="string"||typeof s=="number");return n&&t||n&&o?{key:e,relation:!0,multiple:!!o,type:"relation",priority:1}:!1};var h=e=>e.replace(B,"");var P=e=>h(e).replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").replace(/-/g," ").split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ");var H=e=>e.replace(/export\s+(const|let|var|type|interface|function|class)\s+(\w+)\s*(=|:)\s*/g,"$1 $2 = ").split(`
`).filter(o=>!o.trim().startsWith("export default")).join(`
`);var ne=/import(?:(?:(?:[ \n\t]+([^ *\n\t\{\},]+)[ \n\t]*(?:,|[ \n\t]+))?([ \n\t]*\{(?:[ \n\t]*[^ \n\t"'\{\}]+[ \n\t]*,?)+\})?[ \n\t]*)|[ \n\t]*\*[ \n\t]*as[ \n\t]+([^ \n\t\{\}]+)[ \n\t]+)from[ \n\t]*(?:['"])([^'"\n]+)(?:['"])(?:;?)/g,Ue=/import[ \n\t](?:['"])([^'"\n]+)(?:['"])(?:;?)/g,Ve=/((?:\w|\s|_)*)( as )((?:\w|\s|_)*)( |,)?/g,W=(e,r={})=>{let n=e.matchAll(ne),t=new Set;for(let o of n){let[,s,a,p,c]=o;if(c in r){let f=r[c];if(c==="react")continue;s&&t.add(`const { default: ${s} } = ${f};`),a&&t.add(`const${a.replace(Ve,"$1: $3$4")} = ${f};`),p&&t.add(`const ${p} = ${f};`)}}return V(`
    ${Array.from(t).join(`
`)}
    ${e.replace(ne,"").replace(Ue,"")}
    `)};import D from"pluralize";var Z=(e,r)=>e?r.find(t=>{let o=h(e.key);return t.name===o||t.name===(D.isPlural(o)?o:D.plural(o))||t.name===(D.isSingular(o)?o:D.singular(o))}):void 0;import Be from"pluralize";var _=(e,r,n="Inferred")=>{let t=e.replace(/[^a-zA-Z0-9]/g," "),o=Be.singular(t),a=P(o).replace(/ /g,"")||n,p=r.charAt(0).toUpperCase()+r.slice(1);return/^[a-zA-Z]/.test(a)?`${a}${p}`:`${p}${a}`};var He=e=>e?Array.isArray(e)?e.join(""):typeof e=="string"?e:typeof e=="object"||typeof e=="function"?e.toString():typeof e=="number"?String(e):typeof e=="boolean"&&e?"true":e:"",oe=(e,...r)=>e.reduce((t,o,s)=>`${t}${o}${He(r[s])}`,"").trim();var M=(e,r)=>`
    ${e!=null?e:""}
    
    render(typeof ${r} !== "undefined" ? <${r} /> : <></>);
    `;var q=e=>e==null?void 0:e.replace(/(\/\* hidden-start \*\/)(.|\n)*?(\/\* hidden-end \*\/)/g,"");var We=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/,z=e=>We.test(e);function Y(e,r,n){let t=`${e}`;return r&&(t+="?.",z(r)?t+=r:t+=`['${r}']`),n&&(t+="?.",z(n)?t+=n:t+=`['${n}']`),t}function Ze(e,r,n){return(n!=null?n:[]).map(o=>Y(e,r,o))}var se=(e,r,n,t=' + " " + ')=>Array.isArray(n)?t?Ze(e,r,n).join(t):Y(e,r,n[0]):Y(e,r,n),G=(e,r,n)=>{let t=e;return r&&(t+=`.${r}`),n&&(Array.isArray(n)?t+=`.${n[0]}`:t+=`.${n}`),t},ie=e=>Array.isArray(e.accessor)||e.multiple?`accessorKey: "${e.key}"`:e.accessor?`accessorKey: "${G(e.key,void 0,e.accessor)}"`:`accessorKey: "${e.key}"`;var ae=e=>{let r=e.reduce((t,[o,s,a])=>(t[s]||(t[s]=[]),t[s].includes(o)||(a?t[s].push([o,!0]):t[s].push(o)),t),{});return Object.entries(r).map(([t,o])=>{let s=o.find(f=>Array.isArray(f)&&f[1]),a=o.filter(f=>typeof f=="string"),p=s?`${s[0]}`:"",c=a.length?`{ ${a.join(", ")} }`:"";return`import ${p}${p&&c?", ":""}${c} from "${t}";`})};import ce from"pluralize";var v=(e="")=>ce.isSingular(e)?e:ce.singular(e);import pe from"pluralize";var T=(e="")=>pe.isPlural(e)?e:pe.plural(e);var Me=/^id$/i,le=e=>Me.test(e);var fe=e=>e.relationInfer&&e.relationInfer.accessor?Array.isArray(e.relationInfer.accessor)?`optionLabel: "${e.relationInfer.accessor[0]}",`:e.relationInfer.accessor!=="title"?`optionLabel: "${e.relationInfer.accessor}",`:"":"";var me=e=>{};var ue=(e,r="")=>{if(Number.isInteger(Number(e)))return r.charAt(0).toLowerCase()+r.slice(1)+e;let t=e.replace(/^\d+/,"").replace(/[^a-zA-Z0-9]/g,"-"),o=P(t).replace(/ /g,"");return`${o.charAt(0).toLowerCase()+o.slice(1)}${r.charAt(0).toUpperCase()+r.slice(1)}`};var de=e=>{let r=(n,t,o,s=r)=>{let a=e.map(c=>c(n,t,o,s));return U(a)};return r};var ge=e=>(n,t,o,s,a)=>e.reduce((p,c)=>c(p,t,o,s,a),n);var ye=(e,r,n,t)=>{let o=Array.isArray(r),s=Array.isArray(r)&&r.every(a=>typeof a=="string"||typeof a=="number");if(o){if(!s){let p=t(e,r[0],n,t);return p?{...p,key:e,multiple:!0,priority:1}:!1}let a=t(e,r[0],n,t)||{type:"string"};return{key:e,multiple:!0,priority:1,type:a==null?void 0:a.type}}return!1};var Ie=(e,r)=>typeof r=="boolean"?{key:e,type:"boolean"}:!1;import he from"dayjs";var qe=/(_at|_on|At|On|AT|ON)(\[\])?$/,xe=(e,r)=>{let n=qe.test(e)&&he(r).isValid(),t=typeof r=="string"&&he(r).isValid(),o=typeof r=="string"&&r.length>4;return n||t&&o?{key:e,type:"date",priority:1}:!1};var Ye=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,Fe=(e,r)=>typeof r=="string"&&Ye.test(r)?{key:e,type:"email",priority:1}:!1;var Ge=/\.(gif|jpe?g|tiff?|png|webp|bmp|svg)$/i,be=(e,r)=>typeof r=="string"&&Ge.test(r)?{key:e,type:"image",priority:2}:!1;var Ae=(e,r)=>typeof r>"u"||r===null?null:!1;var ke=(e,r)=>typeof r=="number"?{key:e,type:"number"}:!1;var Je=/id$/i,Ce=(e,r,n,t)=>{let o=r!==null,s=!Array.isArray(r);if(o&&s&&typeof r=="object"){if(Object.keys(r).length===1&&Je.test(Object.keys(r)[0]))return{key:e,type:"relation",relation:!0,accessor:"id",priority:1};let c=E(e,r);if((c?c.length>0:!1)&&c){let g=c&&Array.isArray(c)?c[0]:c,m=t(g,r[g],r,t);if(m){let l=Array.isArray(c)?c.map(u=>m.accessor?`${u}.${Array.isArray(m.accessor)?m.accessor[0]:m.accessor}`:u):m.accessor?Array.isArray(m.accessor)?`${c}.${m.accessor[0]}`:`${c}.${m.accessor}`:c;return{...m,fieldable:!0,key:e,accessor:l,priority:1}}}return{key:e,fieldable:!1,type:"object",priority:1}}return!1};var Re=(e,r)=>typeof r=="string"&&r.length>100?{key:e,type:"richtext",priority:1}:!1;var $e=(e,r)=>typeof r=="string"?{key:e,type:"text"}:!1;var Qe=/^(https?|ftp):\/\/(-\.)?([^\s/?\.#-]+\.?)+(\/[^\s]*)?$/i,we=(e,r)=>typeof r=="string"&&Qe.test(r)?{key:e,type:"url",priority:1}:!1;var ve=[ye,Ie,xe,Fe,be,Ae,ke,Ce,te,Re,$e,we];var Te=(e,r,n,t)=>e.map(s=>{if(!s.relation&&(s.type==="text"||s.type==="richtext"||s.type==="number")&&!s.canRelation){let a=/^[a-z0-9-]+$/,p=l=>a.test(`${l}`),c=s.key.toLowerCase()!=="id";return!(!s.accessor||typeof s.accessor=="string")||!c?s:(s.multiple?t[s.key]:[t[s.key]]).every(l=>p(s.accessor?l[s.accessor]:l))?{...s,canRelation:!0}:s}return s});var Xe=/(image|photo|avatar|cover|thumbnail|icon)/i,Ne=e=>e.map(n=>n.type==="url"&&Xe.test(n.key)?{...n,type:"image"}:n);var Pe=(e,r)=>e.map(t=>{let o=Z(t,r);return o?{...t,relation:!0,type:"relation",resource:o}:t});var Le=(e,r,n,t,o)=>e.map(a=>{if(a.relation&&a.type==="relation"&&!a.resource){let p=a.accessor?t[a.key][a.accessor]:t[a.key],c=o(a.key,p,t,o);if(c&&c.type!=="relation")return{...a,fieldable:!0,relation:!1,type:c.type,canRelation:!0}}return a});var Se=[Ne,Pe,Le,Te];import tn,{useEffect as nn}from"react";import sn,{defaultProps as an}from"prism-react-renderer";import pn from"prism-react-renderer/themes/vsDark";import b from"react";import*as er from"@pankod/refine-core";import{LivePreview as rr,LiveProvider as tr}from"@aliemir/react-live";var Ke=[["react","React",b],["@pankod/refine-core","RefineCore",er]],J=b.createContext({}),Q=({fetchError:e,code:r,additionalScope:n,errorComponent:t})=>{var p;let o=(p=r&&H(W(r,[...Ke,...n!=null?n:[]].reduce((c,[f,g,m,l])=>l?c:{...c,[f]:g},{}))))!=null?p:"",s=b.useMemo(()=>({React:b,...b,...[...Ke,...n!=null?n:[]].reduce((c,[f,g,m])=>({...c,[g]:m}),{})}),[n]),a=b.useMemo(()=>()=>{let{error:f}=b.useContext(J);return t?b.createElement(t,{error:f?`<p>An error occured while rendering the generated component.You can check the generated code from the below "Show Code" button and fix the error manually.</p>
                                    <p>If you think this is a bug, please report the issue at <a target="_blank" rel="noopener noreferrer" href="https://github.com/refinedev/refine/issues">https://github.com/refinedev/refine/issues</a></p>
                                    <p>Exception:</p>
                                    <code>${f}</code>`:typeof e=="string"?e:e?`<p>Something went wrong while fetching the resource data.</p>
                                    <p>To learn more about the Inferencer, please check the <a href="https://refine.dev/docs/packages/documentation/inferencer/" target="_blank">documentation</a>.</p>`:void 0}):null},[t,e]);return b.createElement(tr,{Context:J,code:o,scope:s,noInline:!0},!e&&b.createElement(rr,{Context:J}),b.createElement(a,null))};import L from"react";import{useDataProvider as nr,useResource as or}from"@pankod/refine-core";var je=(e,r,n)=>{let{resource:t,resourceName:o,id:s,resources:a}=or({resourceNameOrRouteName:r}),p=n!=null?n:s,c=nr(),[f,g]=L.useState(void 0),[m,l]=L.useState(void 0),[u,C]=L.useState(!0),[i,x]=L.useState(!1),R=L.useCallback(async y=>{var $,w;let d=($=N(t))!=null?$:O(o,void 0,a),F=c(d);x(!0),g(void 0);try{if(e==="list"||e==="create"){let I=(w=(await F.getList({resource:o})).data)==null?void 0:w[0];I||g(`<p>No records/data found for resource "${o}".</p>
                            <p>Please check your data provider and resource.</p>
                            <p>For more info, please check the <a href="https://refine.dev/docs/packages/documentation/inferencer/" target="_blank">documentation</a>.</p>`),l(I),setTimeout(()=>{x(!1)},500)}if((e==="edit"||e==="show")&&y){let I=(await F.getOne({resource:o,id:y})).data;I||g(`<p>No records/data found for resource "${o}".</p>
                            <p>Please check your data provider and resource.</p>
                            <p>For more info, please check the <a href="https://refine.dev/docs/packages/documentation/inferencer/" target="_blank">documentation</a>.</p>`),l(I),setTimeout(()=>{x(!1)},500)}}catch(k){console.warn("An error occured while fetching the resource data. Please check the error message below:",k),g(`<p>Something went wrong while fetching the resource data.</p>
                    <p>Please check your data provider and API for resource "${o}".</p>
                    <p>For more info, please check the <a href="https://refine.dev/docs/packages/documentation/inferencer/" target="_blank">documentation</a>.</p>`),setTimeout(()=>{x(!1)},500)}},[e,c,t,o,a]);return L.useEffect(()=>{C(!1),!i&&!m&&R(p)},[R,p]),{data:m,loading:i,initial:u,error:f}};import S from"react";import{useDataProvider as sr}from"@pankod/refine-core";import{get as Ee}from"lodash";var De=({record:e,fields:r,infer:n})=>{let t=sr(),[o,s]=S.useState([]),[a,p]=S.useState(!0),[c,f]=S.useState(!1),g=S.useCallback(async m=>{console.groupCollapsed("@pankod/refine-inferencer is trying to detect relations");let l=[];f(!0);try{let u=m.map(async i=>{if(i&&(i.relation||i.canRelation)&&e){let x=N(i.resource),R=t(x),y=Array.isArray(i.accessor)?void 0:i.multiple?e[i.key].map(d=>i.accessor?Ee(d,i.accessor):d)[0]:i.accessor?Ee(e[i.key],i.accessor):e[i.key];if(y&&i.resource)try{let{data:d}=await R.getOne({resource:i.resource.name,id:y});l.push({status:"success",resource:i.resource.name,field:i.key});let F=n("__",d,{},n);return{...i,relationInfer:F}}catch{return l.push({status:"error",resource:i.resource.name,field:i.key}),{...i,relationInfer:null}}if(y){let d,F;try{let{data:k}=await R.getOne({resource:T(h(i.key)),id:y});l.push({status:"success",resource:T(h(i.key)),field:i.key}),d=k,F=!0}catch{l.push({status:"error",resource:T(h(i.key)),field:i.key});try{let{data:I}=await R.getOne({resource:v(h(i.key)),id:y});l.push({status:"success",resource:v(h(i.key)),field:i.key}),d=I,F=!1}catch{return l.push({status:"error",resource:v(h(i.key)),field:i.key}),{...i,relationInfer:null}}}let $=n("__",d,{},n),w=h(i.key);return{...i,relation:!0,type:"relation",resource:{name:F?T(w):v(w)},fieldable:!1,canRelation:void 0,relationInfer:$}}return{...i,relationInfer:null}}return i}),C=await Promise.all(u);s(C.filter(i=>i)),setTimeout(()=>{f(!1)},500)}catch{setTimeout(()=>{f(!1)},500)}setTimeout(()=>{console.log(`Tried to detect relations with ${l.length} attempts and succeeded with ${l.filter(u=>u.status==="success").length} attempts.`),console.groupEnd()},500)},[t,e]);return S.useEffect(()=>{p(!1),!c&&r&&r.length>0&&o.length===0&&g(r)},[g,c,r,g]),{fields:o,loading:c,initial:a}};var ir=({type:e,additionalScope:r=[],customElements:n=[],fieldTransformers:t=[],renderer:o,loadingComponent:s,errorComponent:a,codeViewerComponent:p})=>{let c=de([...ve,...n]),f=ge([...Se,...t]),g=({resourceName:l,fieldTransformer:u,id:C})=>{var ee;let{resource:i,resources:x}=_e({resourceNameOrRouteName:l}),{resource:R}=_e(),{data:y,loading:d,initial:F,error:$}=je(e,l!=null?l:i==null?void 0:i.name,C),w=A.useMemo(()=>{if(y){let ze=Object.keys(y).map(K=>{let j=y[K];return c(K,j,y,c)}).filter(Boolean),re=f(ze,x,i,y,c);return u?re.flatMap(K=>{let j=u(K);return j?[j]:[]}):re}return[]},[y,x,i,u]),{fields:k,loading:I}=De({record:y,fields:w,infer:c}),X=A.useMemo(()=>!d&&!I&&!F?o({resource:i,resources:x,fields:k,infer:c,isCustomPage:i.name!==R.name,id:C}):"",[i,x,k,d,I]);return A.createElement(A.Fragment,null,s&&(d||I)&&A.createElement(s,null),!d&&!I&&A.createElement(A.Fragment,null,A.createElement(Q,{fetchError:!d&&$?$:!d&&!F&&!y,code:M(X,_((ee=i.label)!=null?ee:i.name,e)),errorComponent:a,additionalScope:r}),p&&A.createElement(p,{code:q(X),loading:d||I})))};return({name:l,resource:u,fieldTransformer:C,id:i})=>A.createElement(g,{fieldTransformer:C,resourceName:u!=null?u:l,key:u!=null?u:l,id:i})};export{se as accessor,_ as componentName,ir as createInferencer,N as dataProviderFromResource,G as dotAccessor,ie as getAccessorKey,E as getFieldableKeys,fe as getOptionLabel,ue as getVariableName,le as isIDKey,oe as jsx,me as noOp,P as prettyString,ae as printImports,h as removeRelationSuffix,z as shouldDotAccess,T as toPlural,v as toSingular};
//# sourceMappingURL=index.js.map